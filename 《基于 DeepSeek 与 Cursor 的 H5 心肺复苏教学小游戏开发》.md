# 基于 DeepSeek 与 Cursor 的 H5 心肺复苏教学小游戏开发实践 ——CPR 全流程解析

## 一、项目背景与工具协同目标

依托**DeepSeek**构建结构化提示词框架，结合**Cursor**实现代码开发，打造符合 AHA 2020 指南的 H5 心肺复苏教学小游戏。通过标准化流程控制、实时交互反馈与跨平台适配，实现 “场景化学习 + 游戏化训练” 的深度融合，核心目标是完整复现 CPR 急救流程（CAB 法则），并通过技术手段确保每个操作环节的规范性与真实性。

## 二、CPR 全流程设计与技术实现

### （一）场景初始化阶段

#### 核心功能

**环境搭建**：创建像素风场景（草地、树木、云朵），通过 Cocos Creator 的粒子系统优化背景细节，确保场景元素衔接自然（如树干与树冠连接、草地边缘完整）。

**角色加载**：初始化站立姿势的患者模型，简化头发细节避免面部遮挡，通过骨骼动画系统预定义后续按压、呼吸等动作姿态。

**资源初始化**：加载多模态资源，包括按压音效（节拍器音）、呼吸音效（气流声）、错误提示音（警报声）及成功 / 失败动画资源。

**状态管理**：定义全局状态变量`currentPhase`（初始值为 'intro'），用于控制流程跳转（如`intro`→`check_consciousness`→`call_help`等）。

#### 技术实现（Cursor 代码片段）



```
// 场景初始化逻辑

function initScene() {

&#x20; createBackground(); // 调用Cocos场景编辑器生成的背景组件

&#x20; loadPatientModel({&#x20;

&#x20;   posture: 'stand',&#x20;

&#x20;   faceVisibility: true,&#x20;

&#x20;   scale: 1.5 // 放大模型提升醒目度&#x20;

&#x20; });

&#x20; loadAudioResources(\['click', 'compress', 'breath', 'error', 'success']);

&#x20; currentPhase = 'intro';

}
```

### （二）场景介绍阶段（currentPhase = 'intro'）

#### 交互设计

**视觉呈现**：显示场景介绍文本（如 “你在公园看到有人突然晕倒，请实施急救”），采用动态淡入动画提升沉浸感。

**操作引导**：居中显示 “开始” 按钮，点击后触发`enterCheckConsciousness()`函数，状态切换为`check_consciousness`。

**UI 优化**：按钮样式采用高对比度配色（红色边框 + 白色背景），通过 Cursor 调整按钮层级确保显示在最上层，避免被场景元素遮挡。

#### 问题解决

**原问题**：初始按钮位置与场景元素重叠，文字可读性差。

**解决方案**：通过 Cursor 的 UI 布局工具，将按钮坐标设置为（屏幕中心 X，屏幕高度 ×0.7），文字大小调整为 40px，行距 2 倍，确保在移动端清晰显示。

### （三）检查意识阶段（currentPhase = 'check\_consciousness'）

#### 核心逻辑

**操作选项**：提供两个互斥选项：✅ 正确选项：“轻拍患者肩膀并大声呼叫”（触发意识检测动画，如患者头部微晃）❌ 错误选项：“直接开始胸外按压”（弹出提示 “请先确认患者意识”）

**流程控制**：选择正确选项后，状态切换为`call_help`，并播放提示音效；错误选择则保持当前状态，累计 3 次错误触发 AHA 指南弹窗（DeepSeek 预设合规规则）。

#### 技术实现（Cursor 代码片段）



```
// 选项交互逻辑

function handleOptionSelection(option) {

&#x20; if (currentPhase === 'check\_consciousness') {

&#x20;   if (option === 'tap\_and\_call') {

&#x20;     playSound('correct');

&#x20;     showAnatomyAnimation('head\_tilt'); // 显示仰头动画

&#x20;     currentPhase = 'call\_help';

&#x20;   } else {

&#x20;     playSound('error');

&#x20;     showToast('请先确认患者是否有意识！');

&#x20;     errorCount++;

&#x20;     if (errorCount >= 3) {

&#x20;       openEducationVideo('AHA\_conscious\_check'); // 调用DeepSeek预设的合规视频

&#x20;     }

&#x20;   }

&#x20; }

}
```

### （四）呼叫救援阶段（currentPhase = 'call\_help'）

#### 关键机制

**选项设计**：✅ 正确选项：“大声呼救并拨打 120”（触发虚拟拨号动画，状态切换为`open_airway`）❌ 错误选项：“先进行胸外按压”（提示 “请先确保已呼叫急救中心”）

**音效反馈**：正确选择时播放 “呼救声”+“电话拨号音”，错误选择播放短警报音。

#### 合规性实现

基于 DeepSeek 提示词中 “AED 使用时机判断” 需求，在呼叫救援阶段后预埋 AED 训练关卡接口（后续版本扩展），确保流程符合 “先呼救再施救” 的 AHA 指南原则。

### （五）开放气道阶段（currentPhase = 'open\_airway'）

#### 交互创新

**操作模拟**：通过 Cursor 实现拖拽下巴模型的交互，检测仰头角度（需达到 30° 以上触发绿色反馈），替代传统点击选项模式，提升操作真实感。

**视觉辅助**：显示透明化解剖图层，动态演示 “仰头抬颏法” 如何打开气道（DeepSeek 预设美术需求）。

#### 代码优化

修复初始版本中 “头部指示箭头遮挡面部” 问题，通过 Cursor 调整箭头位置至模型后方，并设置透明度 50%，兼顾引导性与视觉体验。

### （六）胸外按压阶段（currentPhase = 'compression'）

#### 核心技术

**按压检测**：

触屏时长映射深度：5cm 深度对应 300ms 触按时长，通过二次函数算法`calculateDepth(pressTime)`动态计算（误差 ±10%）。

频率控制：基于 Web Audio API 生成 100-120bpm 心跳音轨，按压间隔偏离时触发心电图失真动画。

**反馈系统**：

视觉：按压区域显示动态粒子特效（正确按压时红色血液流动，过深 / 过浅分别显示红色 / 蓝色警告）。

触觉：移动端通过陀螺仪模拟按压震动反馈（需用户授权设备权限）。

#### 流程控制

按压计数达 30 次时，状态切换为`breathing`，重置按压计数并隐藏按压区域；中途中断超 5 秒触发提示 “按压中断时间过长！”。

### （七）人工呼吸阶段（currentPhase = 'breathing'）

#### 交互设计

**吹气量模拟**：通过麦克风检测吹气时长（1-2 秒达标），PC 端使用长按按钮模拟，移动端支持语音输入（“请吹气” 语音指令触发检测）。

**动画表现**：患者胸部随呼吸动作上下起伏，错误操作（如吹气过快）触发胃部膨胀动画（可通过设置关闭创伤模拟）。

#### 代码实现（Cursor 关键逻辑）



```
// 呼吸计时逻辑

function handleBreathInput(duration) {

&#x20; if (currentPhase === 'breathing' && breathCount < 2) {

&#x20;   if (duration >= 1000 && duration <= 2000) { // 符合AHA标准

&#x20;     breathCount++;

&#x20;     playSound('breath\_success');

&#x20;     updateBreathUI(breathCount);

&#x20;     if (breathCount === 2) {

&#x20;       currentPhase = 'transition'; // 进入过渡阶段

&#x20;       showTransitionText('检查患者反应...');

&#x20;     }

&#x20;   } else {

&#x20;     playSound('breath\_error');

&#x20;     showDepthMeter('呼吸时间过长/过短！');

&#x20;   }

&#x20; }

}
```

### （八）过渡与结果阶段（currentPhase = 'transition'/'success'/'failure'）

#### 流程分支

**继续 CPR**：选择 “继续 CPR” 后，重置按压 / 呼吸计数，状态回退至`compression`，严格保持 30:2 按压呼吸比。

**停止 CPR**：触发成功场景，播放救护车动画与胜利音效，显示 “返回主菜单” 按钮；若中途按压 / 呼吸合格率 < 80%，则进入失败场景（灰色遮罩 + 人物倒地动画）。

#### 数据记录

通过 Cursor 实现本地存储，记录每局游戏的按压有效次数、中断时长、总体效率，生成成长曲线（DeepSeek 延伸功能建议）。

## 三、工具协同价值在流程中的体现



| **流程阶段** | **DeepSeek 贡献**                 | **Cursor 实现**                      |
| -------- | ------------------------------- | ---------------------------------- |
| 需求定义     | 输出 CAB 流程核心知识点、AHA 指南合规性要求      | 生成状态机框架（currentPhase 管理）、合规性校验代码   |
| 交互设计     | 提出情景选择系统、动态反馈机制（如热力图、成就系统）      | 实现触屏交互算法、粒子特效与音效同步逻辑               |
| 技术落地     | 推荐 H5 引擎（Cocos Creator）、跨平台适配方案 | 编写 Canvas/WebGL 双渲染代码、微信小游戏 SDK 集成 |
| 细节打磨     | 预设医疗动画规范（如瞳孔反射、肋骨断裂模拟开关）        | 调试骨骼动画参数、优化移动端陀螺仪校准算法              |

## 四、总结：以流程为核心的开发范式

通过将 CPR 流程拆解为可量化的阶段（共 8 大核心阶段、20 + 子步骤），结合 DeepSeek 的领域知识与 Cursor 的代码生成能力，实现了从 “需求建模” 到 “交互落地” 的全流程闭环：

**流程驱动设计**：每个阶段的功能、交互、反馈严格遵循 AHA 指南，确保教育价值；

**状态精准控制**：通过`currentPhase`变量实现流程跳转，避免逻辑漏洞（如未呼叫救援直接进入按压阶段）；

**多模态反馈**：融合视觉（粒子特效）、听觉（节拍器）、触觉（震动反馈），强化操作记忆；

**合规性内置**：错误操作触发指南弹窗、创伤动画可关闭，兼顾教育严谨性与用户接受度。

未来可基于此流程框架，扩展多人协作模式（多人同时按压）、AR 实景模拟（通过摄像头识别真实环境）等功能，进一步提升急救培训的实用性与沉浸感。